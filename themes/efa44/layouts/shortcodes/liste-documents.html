{{/*
  Shortcode dynamique pour lister des fichiers d'un rÃ©pertoire
  Usage: liste-documents dossier="files/activites" titre="Rapports d'activitÃ©s"
  Options: 
    - dossier: chemin relatif dans /static (requis)
    - titre: titre de la section (optionnel)
    - description: description sous le titre (optionnel)
    - icone: emoji pour le titre (optionnel, dÃ©faut: ðŸ“„)
*/}}

{{ $dossier := .Get "dossier" }}
{{ $titre := .Get "titre" }}
{{ $description := .Get "description" }}
{{ $icone := .Get "icone" | default "ðŸ“„" }}

{{ if not $dossier }}
  {{ errorf "Le paramÃ¨tre 'dossier' est requis pour le shortcode liste-documents" }}
{{ end }}

{{ $cheminComplet := printf "static/%s" $dossier }}
{{ $fichiers := readDir $cheminComplet }}

{{ if $fichiers }}
<section class="documents-liste">
  {{ with $titre }}
  <h2>{{ $icone }} {{ . }}</h2>
  {{ end }}
  {{ with $description }}<p>{{ . }} :</p>{{ end }}
  
  <ul class="documents-list">
    {{/* CrÃ©er une liste avec les infos extraites des noms de fichiers */}}
    {{ $items := slice }}
    {{ range $fichiers }}
      {{ if not .IsDir }}
        {{ $nom := .Name }}
        {{ $ext := path.Ext $nom }}
        {{ $nomSansExt := strings.TrimSuffix $ext $nom }}
        
        {{/* Extraire l'annÃ©e du nom de fichier (ex: rapport-activite-2024.pdf -> 2024) */}}
        {{ $annee := "" }}
        {{ if findRE `\d{4}` $nom }}
          {{ $annee = index (findRE `\d{4}` $nom) 0 }}
        {{ end }}
        
        {{/* CrÃ©er un titre lisible Ã  partir du nom de fichier */}}
        {{ $titreDoc := replace $nomSansExt "-" " " }}
        {{ $titreDoc = strings.Title $titreDoc }}
        
        {{ $item := dict "nom" $nom "titre" $titreDoc "annee" $annee "chemin" (printf "/%s/%s" $dossier $nom) }}
        {{ $items = $items | append $item }}
      {{ end }}
    {{ end }}
    
    {{/* Trier par annÃ©e dÃ©croissante */}}
    {{ range sort $items "annee" "desc" }}
    <li class="document-item">
      <a href="{{ .chemin }}" target="_blank" rel="noopener">
        <span class="document-icon">ðŸ“¥</span>
        <span class="document-titre">{{ .titre }}</span>
      </a>
    </li>
    {{ end }}
  </ul>
</section>
{{ else }}
<p><em>Aucun document trouvÃ© dans le dossier {{ $dossier }}</em></p>
{{ end }}
